<% layout('base') -%>

<% script('/lib/jsgif/gif.js') -%>
<% script('/lib/jquery.min.js') -%>
<% script('/js/gifcontrol.js') -%>
<% script('/js/gifchop.js') -%>


<img id="gif" src='<%=image_url%>'>
<div id="gif-controls">
	<div id="timeline">
		<div id="instructions">click on the timeline to choose your frames <%=doc_id%></div>
		<div id="selection"></div>
	</div>
	<div id="gif-ui">
		<!-- <button id="gif-toggle">Autoplay: Off</button> -->
		<button id="gif-submit">Done!</button>
	</div>
</div>

<script type="text/javascript">
	var image_url = '<%=image_url%>';
	var image = document.getElementById('gif');

	gifchopper.load(image_url, image);

	function displayMessage (evt) {
		// document.getElementById("gif").className = evt.data;
		$(".jsgif").attr("class","jsgif "+evt.data);
	}

	if (window.addEventListener) {
		window.addEventListener("message", displayMessage, false);
	}
	else {
		window.attachEvent("onmessage", displayMessage);
	}

	// update db with frame numbers
	$("#gif-submit").click(function() {
		$.ajax({
			type: "POST",
			url: "/selected",
			dataType: "json",
			data: {
				id: '<%=doc_id%>',
				frames: gifchopper.getFrames().toString()
			}
		})
	})
</script>