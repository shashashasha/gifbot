<% layout('base') -%>

<% script('/lib/jquery.min.js') -%>

<div class="bg">
	<div id="triangle"></div>
	<a href="http://127.0.0.1:3000/upload-flipflop" id="back">choose other images</a>
<!-- 	<div class="img-box"></div>
	<div class="img-box"></div> -->
	<div id="wrapper" class="box">
		<div id="b1" class="box"></div>
		<div id="b2-wrapper" class="box">
			<div id="b2" class="box"></div>
		</div>
	</div>
</div>

<style>
	.bg {
		width: 875px;
	}
	.box, #b2-wrapper {
		width: 500px;
		height: 500px;
		position: absolute;
		overflow: hidden;
	}
	#wrapper {
		position: relative;
		margin: 50px auto;
		-webkit-animation: skew 5s infinite;
	}
	@-webkit-keyframes skew {
		0% {
			-webkit-transform: perspective(500) rotateX(-5deg);
		}
		50% {
			-webkit-transform: perspective(500) rotateX(5deg);
		}
		100% {
			-webkit-transform: perspective(500) rotateX(-5deg);
		}
	}
	#b1, #b2 {
		background-size: cover;
		background-position: center;
	}
	#b1 {
		background-image: url(<%=image_url0%>);
	}
	#b2 {
		background-image: url(<%=image_url1%>);
	}
	#b2-wrapper {
		-webkit-animation: wipe 5s infinite;
		-webkit-mask-size: 1040px 1040px;
		-webkit-mask-image: -webkit-gradient(linear, left 0%, left bottom,
				color-stop(0.00,  rgba(0,0,0,1)),
				color-stop(0.45,  rgba(0,0,0,1)),
				color-stop(0.50,  rgba(0,0,0,0)),
				color-stop(0.55,  rgba(0,0,0,0)),
				color-stop(1.00,  rgba(0,0,0,0)));
	}
	@-webkit-keyframes wipe {
		0% {
			-webkit-mask-position: 0px 0px;
		}
		50% {
			-webkit-mask-position: -500px -500px;
		}
		100% {
			-webkit-mask-position: 0px 0px;
		}
	}
	.img-box {
		width: 437px;
		height: 215px;
		float: left;
		background-image: url(http://meshu.io/static/gifpop/img/starburst-wide.png);
		background-color: #808080;
		background-position: center;
		border: solid #eee;
		box-sizing: border-box;
		border-width: 10px 5px;
		margin-bottom: 10px;
		font-size: 170px;
		text-align: center;
		line-height: 204px;
	}
	.img-box:nth-child(even) {
		border-left-width: 10px;
		background-image: url(<%=image_url1%>);
		background-size: cover;
	}
	.img-box:nth-child(odd) {
		border-right-width: 10px;
		background-image: url(<%=image_url0%>);
		background-size: cover;
	}
</style>

<script type="text/javascript">

	function displayMessage (evt) {
		$(".jsgif").attr("class","jsgif "+evt.data);
	}

	if (window.addEventListener) {
		window.addEventListener("message", displayMessage, false);
	}
	else {
		window.attachEvent("onmessage", displayMessage);
	}

	var imgHeight = 580;
	$(".bg").mouseenter(function(){
			// $(".box").css("-webkit-animation-play-state", "paused");
			$(".box").css("-webkit-animation","none")
		}).mousemove(function(e){
			var percentage = 1 - e.offsetY/imgHeight;
			$("#wrapper").css("-webkit-transform","perspective(500) rotateX("+(5-(percentage*20))+"deg)");
			$("#b2-wrapper").css("-webkit-mask-position",-imgHeight*percentage+"px "+-imgHeight*percentage+"px");
		}).mouseleave(function(){
			// $(".box").css("-webkit-animation-play-state", "running");
		});
</script>